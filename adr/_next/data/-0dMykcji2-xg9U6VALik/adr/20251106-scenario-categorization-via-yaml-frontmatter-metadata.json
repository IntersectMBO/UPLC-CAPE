{"pageProps":{"projectName":"UPLC-CAPE","currentAdr":{"slug":"20251106-scenario-categorization-via-yaml-frontmatter-metadata","package":null,"title":"Scenario Categorization via YAML Frontmatter Metadata","status":"accepted","supersededBy":null,"tags":["scenarios","metadata","categorization","reporting"],"deciders":[],"body":{"enhancedMdx":"\nTechnical Story: [Issue #137](https://github.com/IntersectMBO/UPLC-CAPE/issues/137)\n\n## Context and Problem Statement\n\nThe HTML report landing page needs to clearly distinguish between two types of benchmark scenarios: fixed algorithm scenarios (prescribed implementations for compiler comparison) and open optimization scenarios (any approach allowed). Scenarios need an explicit categorization mechanism that works for all cases (e.g., `ecd` is a fixed algorithm scenario, while `fibonacci` is open optimization).\n\n**Question**: How should scenarios be categorized in a way that is explicit, maintainable, and supports the reporting system's need to separate fixed vs open scenarios?\n\n## Decision Drivers\n\n- Need explicit, declarative categorization that doesn't rely on implicit naming patterns\n- Must be easy for scenario authors to specify and understand\n- Should be maintainable and validate-able\n- Must support the HTML report generation system\n- Should be embedded in scenario specification (single source of truth)\n- Must provide clear error messages when misconfigured\n\n## Considered Options\n\n1. **YAML Frontmatter Metadata** - Add `category` attribute to scenario markdown files\n2. **Separate Metadata File** - Create `metadata.json` alongside scenario specification\n3. **Directory Structure** - Use subdirectories like `scenarios/fixed/` and `scenarios/open/`\n4. **Naming Convention** - Use suffixes like `_naive_recursion` to infer category\n\n## Decision Outcome\n\nChosen option: **\"YAML Frontmatter Metadata\"**, because it provides the best balance of explicitness, maintainability, and integration with existing documentation structure.\n\n### Implementation\n\nAdd YAML frontmatter to the beginning of each scenario specification file (`scenarios/{name}/{name}.md`):\n\n```yaml\n---\ncategory: fixed # or \"open\"\n---\n```\n\n**Category Values**:\n\n- `fixed`: Fixed algorithm scenarios requiring prescribed implementation (e.g., `ecd`, `factorial_naive_recursion`, `fibonacci_naive_recursion`)\n- `open`: Open optimization scenarios allowing any approach (e.g., `factorial`, `fibonacci`, `two_party_escrow`)\n\n**Extraction Method**: The `categorize_scenario()` function in `report.sh` extracts the category using AWK:\n\n```bash\ncategory=$(awk 'BEGIN{in_fm=0} /^---$/ {in_fm++; next} in_fm==1 && /^category:/ {print $2; exit}' \"$scenario_file\")\n```\n\n**Error Handling**:\n\n- If scenario file is missing: Error with clear message\n- If category attribute is missing: Error with instructions to add frontmatter\n- If category value is invalid (not \"fixed\" or \"open\"): Error with valid values\n\n### Positive Consequences\n\n- ✅ Explicit categorization visible at the top of scenario specification\n- ✅ Single source of truth (embedded in the spec that defines the scenario)\n- ✅ Easy for scenario authors to understand and specify\n- ✅ Self-documenting (category is part of the specification)\n- ✅ Supports validation and error checking\n- ✅ No additional files or complex directory restructuring required\n- ✅ Standard YAML format familiar to developers\n- ✅ Clear error messages guide users to fix issues\n\n### Negative Consequences\n\n- Requires updating all existing scenario files to add frontmatter\n- Adds a small amount of boilerplate to scenario specifications\n- Requires parsing YAML frontmatter in bash scripts (using AWK)\n\n## Pros and Cons of the Options\n\n### Option 1: YAML Frontmatter Metadata (CHOSEN)\n\n- Good, because it's explicit and declarative\n- Good, because it's embedded in the scenario specification (single source of truth)\n- Good, because YAML frontmatter is a standard pattern in documentation\n- Good, because it's self-documenting\n- Good, because it supports validation\n- Bad, because it requires updating existing files\n- Bad, because it adds boilerplate to scenario specs\n\n### Option 2: Separate Metadata File\n\n- Good, because it separates concerns (spec vs metadata)\n- Good, because it could support more extensive metadata\n- Bad, because it creates multiple files to maintain per scenario\n- Bad, because it fragments the source of truth\n- Bad, because scenario authors must remember to update both files\n\n### Option 3: Directory Structure\n\n- Good, because categorization is visible in file paths\n- Bad, because it requires major directory restructuring\n- Bad, because it complicates scenario naming and references\n- Bad, because moving scenarios between categories is harder\n\n### Option 4: Naming Convention\n\n- Good, because no additional files or metadata required\n- Good, because categorization is visible in the scenario name\n- Bad, because it's implicit and error-prone\n- Bad, because it doesn't cover all cases (e.g., `ecd` doesn't have a distinguishing suffix)\n- Bad, because it couples scenario naming to categorization logic\n- Bad, because scenarios might not follow the pattern consistently\n\n## Migration\n\nAll existing scenario files were updated to include category frontmatter:\n\n**Fixed algorithm scenarios**:\n\n- `scenarios/ecd/ecd.md`: `category: fixed`\n- `scenarios/factorial_naive_recursion/factorial_naive_recursion.md`: `category: fixed`\n- `scenarios/fibonacci_naive_recursion/fibonacci_naive_recursion.md`: `category: fixed`\n\n**Open optimization scenarios**:\n\n- `scenarios/factorial/factorial.md`: `category: open`\n- `scenarios/fibonacci/fibonacci.md`: `category: open`\n- `scenarios/two_party_escrow/two_party_escrow.md`: `category: open`\n\n## Links\n\n- [Issue #137: Improve HTML report landing page](https://github.com/IntersectMBO/UPLC-CAPE/issues/137)\n- Related: <AdrLink slug=\"20251009-scenario-based-approach-replacing-mode-system\" status=\"accepted\" title=\"Scenario-Based Approach: Replacing Mode System with Dedicated Scenarios\" customLabel=\"ADR 20251009: Scenario-Based Approach\" /> - Defines fixed vs open scenarios\n"},"creationDate":"2025-11-07T09:22:23.000Z","lastEditDate":"2025-11-07T09:22:23.000Z","lastEditAuthor":"Yura Lazaryev","publicationDate":"2025-11-06T22:59:59.000Z","file":{"relativePath":"doc/adr/20251106-scenario-categorization-via-yaml-frontmatter-metadata.md","absolutePath":"/home/runner/work/UPLC-CAPE/UPLC-CAPE/doc/adr/20251106-scenario-categorization-via-yaml-frontmatter-metadata.md"},"repository":{"provider":"github","viewUrl":"https://github.com/IntersectMBO/UPLC-CAPE/blob/master/doc/adr/20251106-scenario-categorization-via-yaml-frontmatter-metadata.md"}},"l4bVersion":"1.1.0"},"__N_SSG":true}